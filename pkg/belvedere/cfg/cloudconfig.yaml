#cloud-config

{"write_files":[{"path":"/etc/systemd/system/docker-my-app.service","permissions":"0644","owner":"root","content":"[Unit]\nDescription=Start the my-app container\nWants=gcr-online.target\nAfter=gcr-online.target\n\n[Service]\nEnvironment=\"HOME=/var/lib/docker\"\nExecStartPre=/usr/bin/docker-credential-gcr configure-docker\nExecStart=/usr/bin/docker run --rm --log-driver gcplogs --log-opt labels=app,release --name my-app --network host --oom-kill-disable --label app=my-app --label release=v43 --env RELEASE=v43 --env 'ONE=1 or 2' --env 'TWO=2 or 3' --turbo gcr.io/example/helloworld@sha256:abcdef0123456789 /usr/bin/helloworld one two\nExecStop=/usr/bin/docker stop my-app\nExecStopPost=/usr/bin/docker rm my-app\n"},{"path":"/etc/systemd/system/docker-nginx.service","permissions":"0644","owner":"root","content":"[Unit]\nDescription=Start the nginx container\nWants=gcr-online.target\nAfter=gcr-online.target\n\n[Service]\nEnvironment=\"HOME=/var/lib/docker\"\nExecStartPre=/usr/bin/docker-credential-gcr configure-docker\nExecStart=/usr/bin/docker run --rm --log-driver gcplogs --log-opt labels=app,release,sidecar --name nginx --network host --oom-kill-disable --label app=my-app --label release=v43 --label sidecar=nginx --env 'FOUR=4 or 5' --env 'THREE=3 or 4' --slow gcr.io/example/nginx three four\nExecStop=/usr/bin/docker stop nginx\nExecStopPost=/usr/bin/docker rm nginx\n"}],"runcmd":["iptables -w -A INPUT -p tcp --dport 8443 -j ACCEPT","systemctl daemon-reload","systemctl start docker-my-app.service","systemctl start docker-nginx.service"]}